/* 
	Author: bcersows
	Version: 1.07c
	Date: 09.03.2015
	Last Modified By: bcersows
	###Script_Library-Local.slax;v1.07c;2015.03.09
*/

/****************************************************************************/
/* Junos Space Library by DTAG                                    			*/
/*                                                                         	*/
/* This library includes templates required for use with Junos Space.    	*/
/* It is only responsible for Scripts by Deutsche Telekom, even though		*/
/* it might be used by others as well. No warranty guaranteed!				*/
/*																			*/
/*		Author: Björn Cersowsky, FMED-63, Deutsche Telekom Technik GmbH		*/
/*                                                                        	*/
/****************************************************************************/

/*
	Needed imports:
			ns bcersows = "http://bcersows@telekom.de";
			import "Space_Library-Local.slax";
	Usage:
		To output results:
			copy-of bcersows:insertBackButton();
		To assign results to variable:
			var $devices = bcersows:credentials();
*/

/*
	Functions:
		-bcersows:insertCSS();
		-bcersows:insertJS();
		-bcersows:outputErrorDiv( $resultsNodeSet, $msg );
		-bcersows:insertBackButton();
		-bcersows:insertHeader( $myDevice );
		-bcersows:insertHeaderBig( $myDevice );
		-bcersows:insertCurrentTime();
		-bcersows:insertFloatingButton();
		-bcersows:insertExportWindowButton();
		-bcersows:parseDeviceParameter( $myDevice, $parameterVar );
		-bcersows:insertCompletionTest();
		-bcersows:insertDownloadButton( $tableName, $fileName );
		-bcersows:disableDownloadButton();
		-bcersows:insertTLogo();
		-bcersows:insertConnectionTestMessage();
		-bcersows:insertSoftwareInformation( $connection );
		-bcersows:credentials();
		-bcersows:outputParam( $param );

*/

/*
	Changelog:
	----------
	1.06; 06.08.2014: 
		- Added a help window that is inserted within the headerBig function. Open with F1.
		- traverse() fixed for IE handling..
	1.07; 20.08.2014: 
		- Added function bcersows:credentials to parse grouped-execution credentials.
		09.10.2014:
		- insertExportWindowButton: changed window title for IE compatibility.
		- Replaced the JNPR logo. :)
		- Changed text color for magenta lines to white.
		21.10.2014:
		- Added JS-Funktion "markieren(elem)".
		28.10.2014 - 30.10.2014:
		- Added class warningError for spans.
		- Added fadeOut(element), stopEventPropagation( e ), removeElement( el ) JS functions.
		- Added a popup to the openInNewWindowButton div that gives a hint about its functionality.
		-> New div, new script.
		- @media print: Colored border and text for printing on TDs with background-color.
		- Added icon (in JS).
	1.07c; 09.03.2015:
		- Added some base configs (margin, ...). Devices list markup.
		- New JS function hasClass( className );
		- Support for toggling a view (sliding up, down).
		- Added smooth scrolling for every in-page anchor.
*/

/* Junos Space specific context, name and description */
/* @CONTEXT = "/device[name='hidden']" */
/* @CONTEXT = "/device[name='hidden']" */
/* @NAME = "Local DTAG Junos Space Library" */
/* @DESCRIPTION = "Library file for Junos Space by DTAG." */
/* @ISLOCAL = "true" */

version 1.1;
ns junos = "http://xml.juniper.net/junos/*/junos";
ns xnm = "http://xml.juniper.net/xnm/1.1/xnm";
ns jcs = "http://xml.juniper.net/junos/commit-scripts/1.0";
ns str = "http://exslt.org/strings";
ns jspace = "http://jspace-utils/asharp@juniper.net";
ns bcersows = "http://bcersows@telekom.de";
ns func extension = "http://exslt.org/functions";
ns exsl extension = "http://exslt.org/common";
ns date = "http://exslt.org/dates-and-times";
ns os extension = "http://xml.libslax.org/os";

/* ********* */
/* FUNCTIONS */
/* ********* */

/* bcersows:insertCSS( );
 *
 * Insert CSS tag.
*/
<func:function name="bcersows:insertCSS"> {
    param $type;

    var $style = {
		<link rel="shortcut icon" type="image/png" href="#">;
    	<style type="text/css"> {
			<xsl:text disable-output-escaping="yes">
				"/* Basics, tables, .. */
				h1,h2,h3,h4,h5,h6 { margin: 0px; }
				html {  }
				body { font-family: Verdana, Georgia, Arial, sans-serif; color: #000;
					 margin: 0px; overflow-x: hidden; background-color: #FFF;
					 width: 100%; text-rendering: optimizeLegibility; }
				div, p, span { font-size: 11px; }
				div.header { background-color: rgb(226,0,116); color: WHITE; }
				#head { white-space: nowrap; display: block; width: 666px; }
				div.error { background-color: RED; }
				div.fitting { float: left; }
				table th { font-size: 9px; text-transform: uppercase; text-align: left; }
				table td { font-size: 10px; text-align: left; vertical-align: top; }
				table td.lpadding5 { padding-left: 5px; }
				table td.lpadding15 { padding-left: 15px; }
				table td.lpadding30 { padding-left: 30px; }
				table td.alignLeft, table th.alignLeft { text-align: left; }
				table td.alignCenter, table th.alignCenter { text-align: center; }
				table td.alignRight, table th.alignRight { text-align: right; }
				table.twoColumnTable { table-layout: fixed;  }
				table.xwide { width: 90%;  }
				table.wide { width: 80%;  }
				table.middle { width: 60%;  }
				table.small { width: 40%;  }
				table.twoColumnTable tr td:first-child { width: 40%; max-width: 250px; }
				table.sameSizeColumns { table-layout: auto;  }
				table.sameSizeColumns td { width: 5%;  }
				table td.minorError { background-color: OLIVE;  }
				table td.majorError { background-color: RED;  }
				table td.warningError { background-color: YELLOW;  }
				table td.infoError { background-color: GREEN;  }
				table td.majorError:before { content: '!  ';  border: 1px solid black; cursor: default; float: left; clear: both; 
					margin-left: 2px; margin-top: -1px; margin-bottom: -1px; padding-right: 1px; margin-right: 1px; }"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Text formatting, download button. */
				.bold { font-weight: bold; }
				.italic { font-style: italic; }
				.subheader { width: 100%; overflow: auto; }
				a { color: inherit; }
				a:visited { color: inherit; }
				a:hover { text-decoration: underline overline; }
				a.backButton { display: inline-block; margin-top: 2px; position: relative; }
				h4 a:hover { text-decoration: none !important; }
				a.button { margin: 1px; padding: 1px; background-color: #7590B4; border: outset thin #CCCCCC; color: white; font-weight: bold; cursor: pointer; }
				a.button:hover { color: blue !important; } a.button:visited { color: white; }
				a.disabledButton { color: #999999 !important; background-color: #FFFFFF !important; 
					border: 1px solid #CCCCCC !important; cursor: default !important; pointer-events: none; }
				ua.buttonDownloads:before { content: '▼ '; }
				a.buttonDownloads:before { content: '&#9660'; }
				a.buttonDownloads:before { content: '\\\\/ '; }
				a.buttonDownload:before { content: ''; display: inline-block; width: 0; height: 0; border-left: 6px solid transparent;  
					border-right: 6px solid transparent; border-top: 6px solid black; margin-right: 5px; }
				a.buttonDownload:hover:before { border-top: 6px solid RED; }
				.data, .code { white-space: pre; font-family: monospace; }
				.right { float: right; clear: right; }
				.left { float: left; clear: left; }
				.clearBoth { clear: both; }
				.capitalize { text-transform: capitalize; }
				.alignCenter { text-align: center; }
				.f-sml { font-size: small; };
				.f-sm { font-size: smaller; };
				.of-auto { overflow: auto; }
				.of-hidden { overflow: hidden; }
				.of-scr { overflow: scroll; }
				.m-0 { margin: 0; }
				.ml-5 { margin-left: 5px; }
				.ml-10 { margin-left: 10px; }
				.ml-20 { margin-left: 20px; }
				.mr-5 { margin-right: 5px; }
				.mr-10 { margin-right: 10px; }
				.mr-20 { margin-right: 20px; }
				.cur-default { cursor: default; }
				.cur-pointer { cursor: pointer; }
				.underline { text-decoration: underline; }
				.no-underline, .no-underline:hover { text-decoration: none; }
				.lpadding5 { padding-left: 5px; }
				.lpadding15 { padding-left: 15px; }
				.lpadding30 { padding-left: 30px; }
				.unselectable { -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none;
					-moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; }
				span.majorError, p.majorError, div.majorError { color: RED; }
				span.warningError, p.warningError, div.warningError { color: YELLOW; }
				span.infoError, p.infoError, div.infoError { color: GREEN; }
				
				hr { margin: 1px; }
				#backgroundColorWarning { z-index: 777; float: right; font-size: 8px; display: none; }
				abbr { border-bottom: 1px dotted black; }"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Custom lists. */
				ul.magenta li { list-style: none; color: black; }
				ul.magenta li:before { color: #E20074; content: '\\25A0'; left: -5px; top: -1px; position: relative; }"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Hidden elements. */
				div.hidden { transition: 2s; }
				p.hiddenButton, div.hiddenButton { width: 200px; background-color: rgb(226,0,116); background-color: rgba(226,0,116,0.7); cursor: pointer; padding-left: 6px; 
					-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none;
					-moz-user-select: none; -ms-user-select: none; user-select: none; 
					-moz-border-top-right-radius: 3px; border-top-right-radius: 3px; -moz-border-bottom-right-radius: 3px;
					border-bottom-right-radius: 3px; margin-bottom: 3px; margin-left: -6px; }
				p.hiddenButton:hover, div.hiddenButton:hover { background-color: rgba(226,0,116,0.8); }
				span.hiddenButtonSpan { margin-right: .3em; float: right; }
				
				.toggleView {
					max-height: 1000px;
					overflow: hidden;
					
					-moz-transition: max-height 1s;
					-webkit-transition: max-height 1s;
					transition: max-height 1s;
				}
				.toggleView.toggleView-small {
					max-height: 20px;
				}
				.toggleViewContent {
					border-left: solid thin GREY;
				}
				.toggleViewButton {
					cursor: pointer;
					height: 20px;
					line-height: 20px;
				}
				.toggleViewButton:hover {
					font-weight: bold;
				}
				.toggleViewButton:hover .toggleViewButtonText {
					text-decoration: underline;
				}
				
				/* Other div markup. */
				div#floatingButton { width: 200px; background-color: rgb(226,0,116); background-color: rgba(226,0,116,0.7); cursor: pointer; 
					-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none;
					-moz-user-select: none; -ms-user-select: none; user-select: none; 
					float: right; clear: both; margin-right: 5px; text-align: center; }
				div#floatingButton:hover { background-color: rgba(226,0,116,0.8); }
				div.wholeLine { background-color: rgb(226,0,116); border-top: solid thin BLACK; width: 100%; height: 1.5em; 
					 text-align: right; margin-top: 10px; font-size: 10px; clear: both; border-top-right-radius: 3px; 
					 border-top-left-radius: 3px; color: WHITE; }
				div.footer { position: fixed; bottom: 0px; }
				.greyBack { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgb(220,220,220); 
					background-color: rgba(220,220,220,.7); background-color: transparent\9; 
					filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#4CDCDCDC,endColorstr=#4CDCDCDC); zoom:1; z-index: 555; }
				.popupWindow { position: absolute; top: 13%; height: 74%; left: 15%; width: 74%; 
					background-color: WHITE; z-index: 666; padding-left: 5px; overflow: auto; }
				div#whole { overflow: auto; bottom: 1.5em; top: 1.5em; position: absolute;
				}
				div#helpWindow {
					background-color: white; border: black solid thin; border-radius: 5px;
					position: fixed; width: 80%; height: 70%; top: 10%; left: 10%; z-index: 666;
				}
				div#helpWindow p { padding: 3px; }"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Color declarations. */
				.magenta:not([type=li]) { color: #E20074; }
				.juniper:not([type=li]) { color: #6883A2; }
				li.magenta { color: #E20074; }
				li.juniper { color: #6883A2; }
				.magentaBack { background-color: #E20074; }
				.juniperBack { background-color: #6883A2; }"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Tabs stuff. */
				.tabs { height: 90%; }
				.tabs ul { list-style: none; padding-left: 3px; margin: 0px; }
				.tabs ul li { float: left; background: #fff; border: 1px #aaa solid; border-bottom: none; margin-right: 5px; padding: 5px; }
				.tabs ul li a:hover { text-decoration: none !important; }
				.tabs ul li.active { margin-bottom: -1px; padding-bottom: 6px; }
				.tabInner { clear: both; border: 1px solid #aaa; height: 90%; overflow: hidden; background: #fff; }
				.tabInner div.tabItem { height: 100%; overflow: auto; }
				.tabsLogo { float: right; color: #E20074; text-transform: uppercase; font-weight: bold;
					font-family: 'TeleLogo', 'TeleGroteskNor', 'Cambria', 'Traditional Arabic', serif; cursor: default; user-select: none;}
				.tabsLogo .magentaSquare { display: inline-block; background-color: #E20074; height: 4px; width: 4px; margin-bottom: 4px; }
				.tabsLogo * { font-size: 20px; margin-left: 0px !important; }"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Tooltip */
				.tooltip { display: inline; position: relative; cursor: help; }
				.tooltip:hover:after { background: #E20074; background: rgba(226,0,116,.9); border-radius: 5px; border: solid 1px black;
					bottom: 21px; color: #000; content: attr(title); left: 20%; padding: 3px 4px; position: absolute; z-index: 98;
					min-width: 100px; max-width: 220px; word-wrap: break-word; }
				.tooltip:hover:before { border: solid; border-color: #333 transparent; border-width: 6px 6px 0 6px; bottom: 15px;
					content: ''; left: 50%; position: absolute; z-index: 99; }
				.tooltip.tooltipLeft:hover:after { right: 20% !important; left: auto !important; } 
				.tooltip.tooltipLeft:hover:before { right: 50% !important; left: auto !important; } 
				.tooltipHTML .tooltipHTMLContent { display: none; position: absolute; width: 300px; min-width: 5%; min-height: 5%;
					background-color: #E20074; background: rgba(226,0,116,.9); color: black; padding: 15px 5px 5px 5px; word-wrap: break-word;
					overflow: auto; border-radius: 5px; border: solid 1px black; }
				.tooltipHTML .tooltipHTMLContent:before { content: 'Further Information'; display: block; position: absolute;
					top: -3px; left: 10px;background-color: #E20074; text-decoration: underline; }
				.tooltipHTML:hover .tooltipHTMLContent { display: block; }"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Open in new window button */
				div#openInNewWindowButton { width: 10px; background-color: rgb(226,0,116); background-color: rgba(226,0,116,0.7);
					-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none;
					-moz-user-select: none; -ms-user-select: none; user-select: none; cursor: pointer;
					text-transform: uppercase; border: solid thin black;
					margin-bottom: 3px; position: relative;
					-webkit-transition-duration: 0.3s; -moz-transition-duration: 0.3s;
					transition-duration: 0.3s; -o-transition-duration: 0.3s;
					border-bottom-right-radius: 5px;
					height: 1.3em; z-index: 666; color: WHITE;
				}
				div#openInNewWindowButton:hover {
					background-color: rgba(226,0,116,0.8); width: 220px;
				}
				div#openInNewWindowButton .openInNewWindowButtonBig {
					position: absolute; width: 200px; top: 0px; left: -200px; text-align: center; margin-right: 10px;
				}
				div#openInNewWindowButton:hover .openInNewWindowButtonBig {
					right: 0px; left: inherit;
				}
				div#openInNewWindowButton #openInNewWindowButtonHelpPopup {
					background-color: #FF6600;
					border-radius: 5px;
					border: solid 2px BLACK;
					cursor: pointer;
					display: block;
					left: 5px;
					padding: 5px;
					position: relative;
					top: 18px;
					text-transform: none;
					width: 240px;
					z-index: 1234;
				}
				div#openInNewWindowButton #openInNewWindowButtonHelpPopup:before {
					border-style: solid;
					border-color: BLACK transparent;
					border-width: 0 20px 20px 0;
					bottom: auto;
					content: \"\";
					display: block;
					left: 5px;
					position: absolute;
					top: -20px;
				}
				div#openInNewWindowButton #openInNewWindowButtonHelpPopup:after {
					border-style: solid;
					border-color: #FF6600 transparent;
					border-width: 0 15px 15px 0;
					bottom: auto;
					left: 7px;
					top: -15px;
					content: \"\";
					display: block;
					position: absolute;
					width: 0px;
				}"
			;
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Little red triangles in some elements, as table cells, with title. Can be opted
				out with class noTitleHelp and other tooltip classes. */
				td[title]:not(.noTitleHelp):not(.tooltip):not(.tooltipHTML):after {
					content: '';
					width: 0px;
					height: 0px;
					top: -1px;
					right: -1px;
					float: right;
					position: relative;
					display: inline-block;
					border-style: solid;
					border-width: 0 4px 4px 0;
					border-color: transparent RED transparent;
				}
				td[title]:not(.noTitleHelp):not(.tooltip):not(.tooltipHTML):hover:after {
					displays: none;
					visibility: hidden;
					opacity: 0;
					transition: visibility 0.5s 1.5s, opacity 1.5s linear;
					transition-delays: 0.5s;
				}
				td.majorError[title]:not(.noTitleHelp):not(.tooltip):not(.tooltipHTML):after {
					border-color: transparent BLUE transparent;
				}"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Tile view, supposed for a device overview. */
				.deviceListTiles {
				}
				.deviceListTile {
					background-color: WHITE;
					border: solid thin GREY;
					display: inline-block;
					height: 30px;
					line-height: 30px;
					margin: 2px 2px 2px 2px;
					min-width: 100px;
					text-align: center;
					vertical-align: center;
					width: 17%;
				}
				.deviceListTile:hover {
					border-color: BLACK;
				}
				.deviceListTile-h20 {
					height: 20px;
					line-height: 20px;
				}
				.deviceListTile-h40 {
					height: 40px;
					line-height: 40px;
				}
				.deviceListTile-h50 {
					height: 50px;
					line-height: 50px;
				}"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"/* Prevent the printing of some elements. */
				@media print {
					.backbutton, #openInNewWindowButton {
						display: none !important;
					}
					#whole {
						height: auto !important;
						overflow: visible !important;
						position: relative !important;
						bottom: auto !important;
						top: auto !important;
					}
					.footer {
						position: static !important;
					}
					body {
						position: relative !important; top: 0px !important; bottom: 0px !important; padding-bottom: 1.5em !important; 
						overflow: visible !important;
					}
					
					table td.majorError { color: RED; border: solid 1px RED; }
					table td.infoError { color: GREEN; border: solid 1px GREEN; }
					table td.warningError { color: YELLOW; border: solid 1px YELLOW; }
					
					td[title]:not(.noTitleHelp):not(.tooltip):not(.tooltipHTML):after { display: none; }
					#backgroundColorWarning { display: block !important; }
				}"
			;
		}
    }
    
    <func:result select="$style">;
}

/* bcersows:insertJS( );
 *
 * Insert JS tags with functions.
*/
<func:function name="bcersows:insertJS"> {
    param $type;

    var $js = {
		<script> {
			<xsl:text disable-output-escaping="yes">
				"var favIcon = 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAG1BMVEX////iAHT5zOPoM5DxiL7uZqzzmcf3u9rwd7Uaf4m2AAAATklEQVQYlYXPSw7AIAgE0BnAz/1PbCpgbTTprOAtIAOc4ZaAAiEFJUHhAA2oCdVBJUF0giFhjp6A9dbhffsHx40njWwfMNK2tXuzfmkODGm4AMEPApiDAAAAAElFTkSuQmCC';

				var docHead = document.getElementsByTagName('head')[0];       
				var newLink = document.createElement('link');
				newLink.rel = 'shortcut icon';
				newLink.href = 'data:image/png;base64,'+favIcon;
				docHead.appendChild(newLink);"
			;
		}
		
		/* Register new HTML5 elements with older browsers. */
		<script> {
			<xsl:text disable-output-escaping="yes">
				"document.createElement('section');"
			;
		}
		
    	<script disable-output-escaping="yes"> {
			expr "var allOpen = false;";
			
			expr "\n";
			
			expr "function toggle(el, index) {";
			expr "	if (document.getElementById('hiddenDiv_' + index).style.display == 'none') {";
			expr "	   document.getElementById('hiddenButton_' + index + '_span').innerHTML = '<'; document.getElementById('hiddenDiv_' + index).style.display = 'block';";
			expr "	} else {document.getElementById('hiddenButton_' + index + '_span').innerHTML = '>'; document.getElementById('hiddenDiv_' + index).style.display = 'none';}";
			expr "	checkAll();";
			expr "}";
			
			expr "\n";
			
			expr "function toggleAll( el ) {";
			expr "	var divs = document.getElementsByClassName('hidden'); var spans = document.getElementsByClassName('hiddenButtonSpan');";
			expr "	for (var i = 0; i"; <xsl:text disable-output-escaping="yes"> "<"; expr " divs.length; i++) {";
			expr "		try {";
			expr "		if (allOpen) {";
			expr "			divs[i].style.display = 'none'; spans[i].innerHTML = '>';";
			expr "			el.innerHTML = 'Alle "; <xsl:text disable-output-escaping="yes"> "&ouml;"; expr "ffnen.'; ";
			expr "		} else { divs[i].style.display = 'block'; spans[i].innerHTML = '<'; ";
			expr "			el.innerHTML = 'Alle schlie"; <xsl:text disable-output-escaping="yes"> "&szlig;"; expr "en.';  ";
			expr "		} }catch(e) {}";
			expr "	} if (allOpen) { allOpen = false; } else { allOpen = true; }";
			expr "}";
			
			expr "\n"; 
			
			expr "function checkAll() {";
			expr "	var divs = document.getElementsByClassName('hidden'); var open = false; var close = false; var first = true;";
			expr "	/*try {*/ for (var i = 0; i"; <xsl:text disable-output-escaping="yes"> "<"; expr " divs.length; i++) {";
			expr "		if ( first "; <xsl:text disable-output-escaping="yes"> "&&"; expr " divs[i].style.display == 'block' ) { close = true; first = false;";
			expr "		} else if ( first "; <xsl:text disable-output-escaping="yes"> "&&"; expr " divs[i].style.display == 'none' ) { open = true; first = false;";
			expr "		} else if ( open "; <xsl:text disable-output-escaping="yes"> "&&"; expr " divs[i].style.display == 'block' ) { open = false;";
			expr "		} else if ( close "; <xsl:text disable-output-escaping="yes"> "&&"; expr " divs[i].style.display == 'none' ) { close = false; } ";
			expr "	}";
			expr "	if ( open ) { allOpen = true; document.getElementById('floatingButton').innerHTML = 'Alle "; <xsl:text disable-output-escaping="yes"> "&ouml;"; expr "ffnen.';";
			expr "	} else if ( close ) { allOpen = false; document.getElementById('floatingButton').innerHTML = 'Alle schlie"; <xsl:text disable-output-escaping="yes"> "&szlig;"; expr "en.' } /*} catch(e) {}*/";
			expr "}";
			
			expr "\n"; 
			
			<xsl:text disable-output-escaping="yes">
				"function isIE () {
					var myNav = navigator.userAgent.toLowerCase();
					return (myNav.indexOf('msie') != -1) ? parseInt(myNav.split('msie')[1]) : false;
				}
				
				function endsWith( str, suffix ) {
					return str.indexOf( suffix, str.length - suffix.length ) !== -1;
				}
				
				/* When IE, then try to add trim() as a function. Shame on you, Microsoft! */
				if ( typeof String.prototype.trim !== 'function' ) {
					String.prototype.trim = function() {
						return this.replace( /^\s+|\s+$/g, '' );
					}
				}
				
				function traverse( tableName, fileName ) {
					var it0, it1;
					var result = '';
					if ( typeof(fileName) === 'undefined' ) { fileName = 'csvResults.csv'; }
					if ( !endsWith( fileName, '.csv' ) ) { fileName += '.csv'; }
					var table = document.getElementById( tableName );
					if ( !isIE() ) {	/* IE sucks.. */
						if ( table === null || !(table instanceof HTMLTableElement) ) { alert( 'Table ID not found or ID not a table. Please contact the Script creator!' ); return; }
					}
					var rows = table.rows;
					for ( it0 = 0; it0 != rows.length; it0++ ) {
						var cells = rows[ it0 ].cells;
						for ( it1 = 0; it1 != cells.length; it1++ ) {
							result += cells[ it1 ].innerHTML.replace(/,/g,'_').replace(/\\n/g,'').replace(/<br>/g, ' ').replace(/<ima?ge? .*?>/g, ' ').replace(/<span.*>(.*?)<\\/span>/g, '$1').replace(/<a.*>(.*?)<\\/a>/g, '$1').trim();
							if ( it1 != cells.length - 1 ) { result += ','; }
						}
						result += '\\n';
					}
				
					if ( isIE() ) {
						var greyBack = document.createElement('div');
						greyBack.setAttribute( 'id', 'greyBack' ); greyBack.setAttribute( 'class', 'greyBack' ); greyBack.setAttribute( 'className', 'greyBack' );
						document.body.appendChild( greyBack );
						var popupWindow = document.createElement('div');
						popupWindow.setAttribute( 'id', 'popupWindow' ); popupWindow.setAttribute( 'class', 'popupWindow' ); popupWindow.setAttribute( 'className', 'popupWindow' ); 
						var element = document.createElement('a'); element.innerHTML = 'Close';
				
						element.setAttribute( 'href', '#' ); element.onclick = function() { document.body.removeChild( document.getElementById('greyBack') );
						document.body.removeChild( document.getElementById('popupWindow') ); return false; };
						element.setAttribute( 'class', 'button right' ); element.setAttribute( 'className', 'button right' );
						popupWindow.appendChild( element );
						element = document.createElement('h3'); element.innerHTML = 'As IE sucks, I will print the output here.';
						popupWindow.appendChild( element );
						element = document.createElement('p'); var resultArray = result.split('\\n'); element.innerHTML = '';
						for ( it0 = 0; it0 != resultArray.length; it0++ ) { 
							element.innerHTML += resultArray[ it0 ];
							if ( it0 != resultArray.length - 1 ) { element.appendChild( document.createElement('br') ) }
						}
						popupWindow.appendChild( element ); 
						element.setAttribute( 'style', 'border: dashed thin; margin-right: 5px;' ); element.style.border = 'dashed thin'; element.style.marginRight = '5px';
						document.body.appendChild( popupWindow );
					} else {
						var csvContent = 'data:text/csv;charset=utf-8,';		
						var encodedUri = encodeURIComponent(result);
						var link = document.createElement('a');
						link.setAttribute('href', csvContent + encodedUri);
						link.setAttribute('download', fileName);
						document.body.appendChild( link );
						link.click();
						document.body.removeChild( link );
					}
				}"
			;
			
			expr "\n"; 
			
			<xsl:text disable-output-escaping="yes">
				"function setActiveTab( el ) {
					var childNodes = el.parentNode.parentNode.childNodes;
					for ( i = 0; i != childNodes.length; i++ ) {
						if ( childNodes[i].className ) {
							childNodes[i].removeClass('active');
						} else {
							childNodes[i].className = '';
						}
					}
					el.parentNode.addClass( 'active' );
					location.hash = el.getAttribute('href'); location.hash = '#' + el.id; return false;
				}
				
				/* Some standard functions. */
				if ( typeof HTMLElement.prototype.removeClass !== 'function' ) {
					HTMLElement.prototype.removeClass = function( remove ) {
						if ( !this.className ) {
							this.className = '';
						}
						if ( this.hasClass( remove ) ) {
							var newClassName = ''; var i; var classes = this.className.split( ' ' );
							for ( i = 0; i != classes.length; i++ ) {
								if ( classes[i] !== remove ) {
									newClassName += classes[i] + ' ';
								}
							}
							this.className = newClassName;
						}
					}
				} else { console.log('Could not bind function removeClass.'); }
				if ( typeof HTMLElement.prototype.addClass !== 'function' ) {
					HTMLElement.prototype.addClass = function( add ) {
						if ( !this.className ) {
							this.className = '';
						}
						if ( !this.hasClass( add ) ) {
							this.className = this.className + ' ' + add;
						}
					}
				} else { console.log('Could not bind function addClass.'); }
				if ( typeof HTMLElement.prototype.hasClass !== 'function' ) {
					HTMLElement.prototype.hasClass = function( className ) {
						if ( this.className ) {
							if ( this.className.match( new RegExp('(^|\\\\b)' + className + '(\\\\b|$)') ) ) {
								return true;
							}
						}
						return false;
					}
				} else { console.log('Could not bind function hasClass.'); }
				
				if ( typeof $qsa !== 'function' && typeof document.querySelectorAll !== undefined ) {
					$qsa = function( selector ) {
						return document.querySelectorAll( selector );
					}
				}
				
				if ( typeof String.prototype.contains !== 'function' ) {
					String.prototype.contains = function( val ) {
						return this.indexOf( val ) != -1;
					}
				}"
			;
			
			expr "\n";
			
			<xsl:text disable-output-escaping="yes">
				"function showPopup( parent, show, popupClassName ) {
					if ( typeof popupClassName === 'undefined' ) { popupClassName = 'tooltipHTMLContent'; }
					var popup = parent.getElementsByClassName( popupClassName )[0];
					if ( show ) {
						popup.style.display='block';
						var screenPos = popup.getBoundingClientRect();
						if ( popup.offsetLeft < 0 ) { popup.style.left = '0px'; }
						if ( popup.offsetTop < 0 ) { popup.style.top = '0px'; }
						if ( popup.offsetLeft + popup.offsetWidth > document.body.clientWidth + (document.documentElement.scrollLeft||document.body.scrollLeft) ) { popup.style.left = (document.body.clientWidth - popup.offsetWidth + (document.documentElement.scrollLeft||document.body.scrollLeft) - 5) + 'px'; }
						if ( popup.offsetTop + popup.offsetHeight > document.body.clientHeight + (document.documentElement.scrollTop||document.body.scrollTop) ) { popup.style.top = (document.body.clientHeight - popup.offsetHeight + (document.documentElement.scrollTop||document.body.scrollTop) - 5) + 'px'; }
					
					} else {
						popup.style.display='none';
						popup.style.left = 'auto';
						popup.style.top = 'auto';
					}
				}
				
				function removeMultiLines( tableName, columnNumber ) {
					var it0;
					var content = '';
					var table = document.getElementById( tableName );
					if ( table ) {
						if ( columnNumber >= 0 && columnNumber < table.rows[0].cells.length ) {
							var rows = table.rows;
							for ( it0 = 0; it0 != rows.length; it0++ ) {
								if ( columnNumber < rows[ it0 ].cells.length )
								var cell = rows[ it0 ].cells[ columnNumber ];
								if ( cell.innerHTML == content ) {
									cell.style.visibility = 'hidden';
								} else {
									content = cell.innerHTML;
								}
							}
						}
					}
				}
				
				function markieren (elem) {
					if (document.selection && document.selection.createRange) {
						var textRange = document.selection.createRange();
						textRange.moveToElementText(elem);
						textRange.select();
					} else if (document.createRange && window.getSelection) {
						var range = document.createRange();
						range.selectNode(elem);
						var selection = window.getSelection();
						selection.removeAllRanges();
						selection.addRange(range);
					}
				}
				
				/* Fade out an element. */
				var stopTimeout = false;
				function fadeOut(element) {
					var op = 1;  // initial opacity
					var timer = setInterval(function () {
						if ( element != null ) {
							if ( stopTimeout ) {
								element.style.filter = 'alpha(opacity=100)';
								element.style.opacity = '1.0';
								clearInterval(timer);
								return;
							}
							if (op <= 0.1){
								clearInterval(timer);
								element.style.display = 'none';
							}
							element.style.opacity = op;
							element.style.filter = 'alpha(opacity=' + op * 100 + ')';
							op -= op * 0.1;
						} else {
							clearInterval(timer);
						}
					}, 50);
				}
				
				/* Used for onclicks. Stops event propagation (bubbling of event to higher elements). */
				function stopEventPropagation ( e ) {
					if (!e) { e = window.event; }
					if (e.stopPropagation) {
						e.stopPropagation();
					}
					else {
						e.cancelBubble = true;
					}
				}
				
				/* Removes an element. */
				function removeElement( el ) {
					if ( el != null ) {
						el.parentNode.removeChild( el );
					}
				}"
			;
			<xsl:text disable-output-escaping="yes">
				"/* Toggle a view with class 'toggleView'. Description of current state in .toggleViewButtonText in the class 'toggleViewButton'. */
				function toggleViewFunction( elem ) {
					elem = elem.target;
					while ( !elem.hasClass( 'toggleViewButton' ) ) { elem = elem.parentNode; }
					var button = elem;
					var wrapper = button.parentNode;
					var textField = button.getElementsByClassName('toggleViewButtonText')[0];
					if ( wrapper.hasClass( 'toggleView-small' ) ) {
						wrapper.removeClass( 'toggleView-small' );
						if ( textField !== undefined ) { textField.innerHTML = 'Hide'; }
					} else {
						wrapper.addClass( 'toggleView-small' );
						if ( textField !== undefined ) { textField.innerHTML = 'Show'; }
					}
				}
				
				window.addEventListener('load', function() {
					var deviceResultsElements = document.getElementsByClassName('toggleViewButton');
					for ( var i = 0; i < deviceResultsElements.length; i++) {
						deviceResultsElements[i].addEventListener( 'click', toggleViewFunction );
						try { deviceResultsElements[i].getElementsByClassName('toggleViewButtonText')[0].innerHTML = 'Hide'; } catch (e) { console.log('Error while setting initial button text.'); }
					}
				});"
			;
			<xsl:text disable-output-escaping="yes">
				"/* Turns every link to a local anchor into a smooth scroller. */
				(function() // Code in a function to create an isolate scope
				{
					var speed = 500;
					var moving_frequency = 15; // Affects performance !
					if ( typeof forEach !== undefined && typeof $qsa !== undefined ) {
					window.addEventListener('load', function() {
						[].forEach.call( $qsa( 'a[href^=\"#\"].smoothScroll:not([href=\"#\"]' ), function( el ) {
							el.addEventListener( 'click', function( evt ) {
								var element = evt.target;
								/* In case a child element of the link was clicked. */
								while( !element.hasAttribute( 'href' ) ) { element = element.parentNode; }
								var href = element.getAttribute( 'href' );
								href = href.replace( /.*(#.*)$/, '$1' );
								var targetElement = $qsa( href )[0];
								var scrollableParent = getScrollableParent( targetElement );
								if ( targetElement !== undefined ) {
									var hop_count = Math.ceil( speed/moving_frequency );
									var getScrollTopDocumentAtBegin = getScrollTop( scrollableParent );
									var gap = ( cumulativeOffset( targetElement, scrollableParent ).top - scrollableParent.offsetTop - getScrollTopDocumentAtBegin ) / hop_count;
									
									for (var i = 1; i <= hop_count; i++) {
										(function() {
											var hop_top_position = gap*i;
											setTimeout(function(){  scrollableParent.scrollTop = hop_top_position + getScrollTopDocumentAtBegin; }, moving_frequency*i);
										})();
									}
									evt.preventDefault();
								}
							});
						});
					});
				}
				var getScrollTopElement =  function (e) {
					var top = 0;
					while (e.offsetParent != undefined && e.offsetParent != null) {
						top += e.offsetTop + (e.clientTop != null ? e.clientTop : 0);
						e = e.offsetParent;
					}
					return top;
				};
				var getScrollTop = function( element ) {
					return element.scrollTop + document.body.scrollTop;
				};
				/* Get the first parent of the element that is scrollable. */
				var getScrollableParent = function( element ) {
					while ( element.scrollHeight <= element.clientHeight ) {
						if ( element.parentNode === undefined ) { return null; }
						element = element.parentNode;
					}
					return element;
				}
				})();
				
				/* Adds up all offsets to calculate the position on the page (or within maxAncestor, if given). */
				var cumulativeOffset = function(element, maxAncestor) {
					var top = 0, left = 0;
					do {
						top += element.offsetTop  || 0;
						left += element.offsetLeft || 0;
						element = element.offsetParent;
					} while( element && element != maxAncestor );

					return {
						top: top,
						left: left
					};
				};"
			;
		}
    }
    <func:result select="$js">;
}

/* bcersows:outputErrorDiv( $resultsNodeSet, $msg );
 *
 * Output the error formatting. Shown when an error occured with an executed command.
*/
<func:function name="bcersows:outputErrorDiv"> {
    param $resultsNodeSet;
	param $msg;

    var $style = {
		if( $resultsNodeSet//self::xnm:error ) {
			<div class="error"> {
				<span class="bold"> { expr $msg; } <br>;
				for-each ( $resultsNodeSet//self::xnm:error ) {
					expr .; <br>;
				}
			}
		}
    }
    
    <func:result select="$style">;
}

/* bcersows:insertBackButton( $inParagraph );
 *
 * Inserts a back button to jump at the top at the desired location. When $inParagraph is set, put a paragraph around.
*/
<func:function name="bcersows:insertBackButton"> {
    param $inParagraph;
	
	var $style = {
		if ( $inParagraph ) {
			<p> {
				<a href="#head" class="backButton smoothScroll">{ expr "Zum Anfang"; }
			}
		} else {
			<a href="#head" class="backButton smoothScroll">{ expr "Zum Anfang"; }
		}
    }
    <func:result select="$style">;
}

/* bcersows:insertHeaderBig( $myDevice );
 *
 * Inserts the header. Includes a curved border at the bottom. Also modifies the parent iframe, adds a print warning and adds a
 * media style that only applies while printing to prevent back buttons, ... from showing.
*/
<func:function name="bcersows:insertHeaderBig"> {
    param $myDevice;
	
	var $output = {
		<div> {
			<div class="header"> { 
				<div id="backgroundColorWarning" class="unselectable magenta"> "Please enable to print background colors for better output.";
				<h4 style="margin-bottom: 0px;"> { 
					<a id="head" name="head" title="BNG(s): " _ $myDevice _ "."> { 
						<xsl:text disable-output-escaping="yes"> "&Uuml;bersicht &uuml;ber Device"; expr " " _ $myDevice;
						if ( $junos-context/user-context/host-name ) { 
							expr " ("; <span class="italic"> { expr $junos-context/user-context/host-name; } expr ")";
						} else {
							
						}
						expr ". "; 
					} 
				} 
				<div class="wholeLine" style="background-color: WHITE; margin-top: 0px; height: 5px;"> { expr " "; }
			}
			copy-of bcersows:insertCurrentTime();
			<hr class="magenta">;
			
			<div id="helpWindow" style="display: none;"> {
				<image src="./../mainui/images/help-15x15.png" style="vertical-align: top; float: left;" title="HELP" alt=" " height="15px">;
				<p style="font-size: 9px;" class="right"> "Press F1 again to close.";
				<h4> "Help Window";				
				<div style="overflow: auto; height: 80%; clear: both;"> {
					expr "The most needed informations in one place.";
					<table class="twoColumnTable xwide"> {
						<tr> {
							<th> "Little red/black triangle in top right corner";
							<td title="This is the popup."> "There is a popup with further information. Hover the mouse over the field to see more.";
						}
						<tr> {
							<th> "Links";
							<td> {
								<a href="#" onclick="return false;"> "Look like this.";
							}
						}
						<tr> {
							<th> "Download";
							<td> {
								expr "Allows to download the information (e.g. tables) as a CSV file.";
								<a href="#" onclick="return false;" class="button buttonDownload" title="Download the output table as CSV."> { expr "Download"; }
							}
						}
						<tr> {
							<th> "Button to reveal more information";
							<td> {
								<p class="bold hiddenButton" onclick="" style="padding: 0px; margin-left: 0px;"> {
									expr "Speicherauslastung";
									<span class="hiddenButtonSpan"> { expr ">"; }
								}
							}
						}
						<tr> {
							<th> "Abbreviation";
							<td> {
								expr "This is an ";
								<abbr title="And this is its explanation."> "abbreviation";
								expr ".";
							}
						}
						<tr> {
							<th> "Contact information";
							<td> "In case of problems, please contact bjoern.cersowsky@telekom.de.";
						}
					}
					<img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH0AAAAmCAYAAADpyZQRAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goNCSUQpq/sjwAAAwBJREFUeNrtm01o1EAUx3/Rqlhb8Ysi6E4oKPiBFBTxIIIFoaCUgpfiUQU9SS8KNgURYWeLeNDipVRvglqkFK8KPYheBQXFg5ZmKUqtH6D4VXU8ZNe2y2a7TXeTbPP+EAiZlzeT98u8mQwZi4TJxdkI3Ay52iXAiEJfjkMM6kieGoDDFfBjAGse9r/iEoAlCYReP0f5Z2DQYPYrtAW0+dh15cp3AteBD3P4bRTokclqKFF4SqHXKnSnTeZJ7tpKH9sVAAr9AswZhd4AbAN+l8gwAj0amWI9bgpoVOiBLD3z9qjI4OKg0K+Ml0nGi0Gf4KJAj3BMLxicLaXQXwFSpAM5Veh8JplS6M3A2wKTZU0CPTbQj9mk31XKuU2aMRwM7C0oWirpPTrNTO8/FPqOqXAPtNHY6HFgOI6xTnpPPwlgVSHtjnIe4JJAj8dEbib0h28CTNzKUTO9KPRT4GPcYp3AxZnpTzaFngihwmHghPT0eKT3ByHV91jSe0ygG7gfUn0vJb1HPaLDoAUNFjwKqUoXeAbcFugRaIxubPQQMOTR6EaRqWqdyvt0a5muPxN5HBKV3gsDrkIGEAfgsYReztp3Fidhvp2KxrguOBxnE3DUGyaL+r2VQk/O12+KNFl6WsAc8HtRU+i+IG3O+W4Ds9XHZCqF7l+A73YwduV9a7I4XcAfH5Ofhr8Dit7qQjewBSgV/BFgMqD7gwaulijvC95ucxzo9Cn+AvQvwPdp4Eh1fJeMxyeDNSBjukigiwS6QBcJdJFAT5SsKt5vxbjd0aqcRQ4XJ9BDumUschTauDgdLo4pcpxdqO9Ktjs5b0gIcnE6mP3bU17nFPqKpHeRQBcJ9KRO7gR6DWq5z/VVAn3xan3x7m+aBPri1Y5iFw1Wq0BffJ9q+dNDPibbx3BWj87azyDQa1ZZbwcqLs4NvO3HfjO8u81ckJlpDffsfUArsAbYDewB1pVx6zfgNd5/9O+B7wp9Lc7PWie4/6sdAu1xqgd25Y68BHqN6DlwLwnZ8x8Ey8Ib1oV8LgAAAABJRU5ErkJggg=='>;
				}
				<p class="magenta unselectable" style="position: absolute; bottom: -2px; right: 2px; padding: 0px; font-size: 9px;"> "(c) bcersows";
			}
			<script> {
				<xsl:text disable-output-escaping="yes">
					"document.onkeydown = checkForHelpKey;
					parent.document.onkeydown = checkForHelpKey;
					
					function checkForHelpKey(e) {
						e = e || window.event;
						/* Open with F1, close with F1 or Esc */
						if ( e.keyCode == 112 || e.keyCode == 27 ) {
							try {
								var helpWindow = document.getElementById( 'helpWindow' );
								if ( helpWindow.style.display == 'none' && e.keyCode == 112 ) {
									helpWindow.style.display = 'block';
									var greyBack = document.createElement('div');
									greyBack.setAttribute( 'id', 'greyBack' ); greyBack.setAttribute( 'class', 'greyBack' ); 
									document.body.appendChild( greyBack );
								} else {
									helpWindow.style.display = 'none';
									document.body.removeChild( document.getElementById('greyBack') );
								}
							} catch (err) {}
						}
					}"
				;
			}
		}
		<script> {
			<xsl:text disable-output-escaping="yes">
				"var myPar = top;
				try {
					var myIframe = parent.document.getElementById('ScriptExecutionResultsIframeURLID2');
					if ( !myIframe ) {
						myIframe = parent.parent.document.getElementById('ScriptExecutionResultsIframeURLID2');
						if ( !myIframe ) {
							myIframe = parent.document.getElementById('success_result_iframe');
						}
					}
					var newStyle = document.createElement('style'); newStyle.setAttribute('media', 'print');
					newStyle.appendChild(document.createTextNode('#ScriptExecutionResultsIframeURLID2, #success_result_iframe{ height: 10000px !important; }'));
					newStyle.appendChild(document.createTextNode('#iframeWarning{ font-size: 10px; position: absolute; top: 10px; left: 10px; text-align: center; background-color: RED; border: solid thin black; border-radius: 5px; display: block !important; max-width: 500px; }'));
					newStyle.appendChild(document.createTextNode('#iframeWarning .iframeWarningExMark { font-size: 15px; font-weight: bold; margin-right: 3px; }'));
					newStyle.appendChild(document.createTextNode('#iframeWarning span { vertical-align: middle; display: inline-block; }'));
					myIframe.parentNode.appendChild( newStyle );
					newStyle = document.createElement('style'); newStyle.setAttribute('media', 'screen');
					newStyle.appendChild(document.createTextNode('#iframeWarning{ display: none; }'));
					myIframe.parentNode.appendChild( newStyle );
					var iframeWarning = document.createElement('div');
					iframeWarning.innerHTML = '<span class=\"iframeWarningExMark\">!</span><span>Printing of the Script results not possible, due to the programming of Space. Please use the export possibilites from inside the Script results or save the whole page as HTML.</span>';
					iframeWarning.setAttribute('id', 'iframeWarning');
					iframeWarning.setAttribute('style', 'display: none;');
					myIframe.parentNode.appendChild( iframeWarning );
					myIframe.appendChild( newStyle );
				} catch (e) {  console.log( 'Error while adding extra styling to iFrame: ' + e ); }
				try {
					var logo = myPar.document.getElementById('image-1016');
					logo.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH0AAAAmCAYAAADpyZQRAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goNCSUQpq/sjwAAAwBJREFUeNrtm01o1EAUx3/Rqlhb8Ysi6E4oKPiBFBTxIIIFoaCUgpfiUQU9SS8KNgURYWeLeNDipVRvglqkFK8KPYheBQXFg5ZmKUqtH6D4VXU8ZNe2y2a7TXeTbPP+EAiZlzeT98u8mQwZi4TJxdkI3Ay52iXAiEJfjkMM6kieGoDDFfBjAGse9r/iEoAlCYReP0f5Z2DQYPYrtAW0+dh15cp3AteBD3P4bRTokclqKFF4SqHXKnSnTeZJ7tpKH9sVAAr9AswZhd4AbAN+l8gwAj0amWI9bgpoVOiBLD3z9qjI4OKg0K+Ml0nGi0Gf4KJAj3BMLxicLaXQXwFSpAM5Veh8JplS6M3A2wKTZU0CPTbQj9mk31XKuU2aMRwM7C0oWirpPTrNTO8/FPqOqXAPtNHY6HFgOI6xTnpPPwlgVSHtjnIe4JJAj8dEbib0h28CTNzKUTO9KPRT4GPcYp3AxZnpTzaFngihwmHghPT0eKT3ByHV91jSe0ygG7gfUn0vJb1HPaLDoAUNFjwKqUoXeAbcFugRaIxubPQQMOTR6EaRqWqdyvt0a5muPxN5HBKV3gsDrkIGEAfgsYReztp3Fidhvp2KxrguOBxnE3DUGyaL+r2VQk/O12+KNFl6WsAc8HtRU+i+IG3O+W4Ds9XHZCqF7l+A73YwduV9a7I4XcAfH5Ofhr8Dit7qQjewBSgV/BFgMqD7gwaulijvC95ucxzo9Cn+AvQvwPdp4Eh1fJeMxyeDNSBjukigiwS6QBcJdJFAT5SsKt5vxbjd0aqcRQ4XJ9BDumUschTauDgdLo4pcpxdqO9Ktjs5b0gIcnE6mP3bU17nFPqKpHeRQBcJ9KRO7gR6DWq5z/VVAn3xan3x7m+aBPri1Y5iFw1Wq0BffJ9q+dNDPibbx3BWj87azyDQa1ZZbwcqLs4NvO3HfjO8u81ckJlpDffsfUArsAbYDewB1pVx6zfgNd5/9O+B7wp9Lc7PWie4/6sdAu1xqgd25Y68BHqN6DlwLwnZ8x8Ey8Ib1oV8LgAAAABJRU5ErkJggg==';
				} catch (e) { console.log('logo: ' + e); }"
			;
		}
    }
    <func:result select="$output">;
}

/* bcersows:insertHeader( $myDevice );
 *
 * Inserts the standard header.
*/
<func:function name="bcersows:insertHeader"> {
    param $myDevice;
	
	var $style = {
		<div class="header"> {
			<div id="backgroundColorWarning" class="unselectable magenta"> "Please enable to print background colors for better output.";
			<h4 style="margin-bottom: 0px;"> {
				<a id="head" name="head" title="BNG(s): " _ $myDevice _ "."> {
					<xsl:text disable-output-escaping="yes"> "&Uuml;bersicht &uuml;ber Device"; expr " " _ $myDevice;
					if ( $junos-context/user-context/host-name ) { 
						expr " ("; <span class="italic"> { expr $junos-context/user-context/host-name; } expr ")";
					} else {
						
					}
					expr ". "; 
				} 
			} 
		}
		copy-of bcersows:insertCurrentTime();
    }
    <func:result select="$style">;
}

/* bcersows:insertCurrentTime();
 *
 * Inserts the information field with the current date and time.
*/
<func:function name="bcersows:insertCurrentTime"> {
    param $myDevice;
	
	var $style = {
		<div id="timeInformation"> {
			expr "Datum: " _ format-number( date:day-in-month(), "00" ) _ " " _ date:month-abbreviation() _ " " _ date:year() _ ".";
			<br>;
			expr "Zeit: " _ format-number( date:hour-in-day(), "00" ) _ ":" _ format-number( date:minute-in-hour(), "00" ) _ ":" _ format-number( date:second-in-minute(), "00" ) _ ".";
		}
    }
    <func:result select="$style">;
}

/* bcersows:insertFloatingButton();
 *
 * Inserts a floating button used to open/close all hidden divs on a page.
*/
<func:function name="bcersows:insertFloatingButton"> {
    var $style = {
		<div id="floatingButton" onclick="toggleAll(this); return false;"> { 
			expr "Alle "; <xsl:text disable-output-escaping="yes"> "&ouml;"; expr "ffnen.";
		}
    }
    <func:result select="$style">;
}

/* bcersows:insertExportWindowButton();
 *
 * Inserts a button used to open a new window, which could be used for exporting the whole content, but not space.
*/
<func:function name="bcersows:insertExportWindowButton"> {
    var $return = {
		<script id="openInNewWindowButtonScript" disable-output-escaping="yes"> {
			<xsl:text disable-output-escaping="yes"> 
				"function openInNewWindow() {
					var myWindow = window.open('about:blank', 'ExportWindow', 'scrollbars=yes,menubar=yes,location=no');
					myWindow.document.write( document.getElementsByTagName( 'html' )[0].outerHTML );
					var openButton = myWindow.document.getElementById('openInNewWindowButton');
					openButton.parentNode.removeChild( openButton );
				}"
			;
		}
		<div id="openInNewWindowButton" onclick="openInNewWindow(); return false;" title="Open in new window to export only the script results."> {
			<xsl:text disable-output-escaping="yes"> ">";
			<div class="openInNewWindowButtonBig"> {
				expr "Open results in new window";
			}
			<div id="openInNewWindowButtonHelpPopup" onclick="stopEventPropagation( event ); removeElement(this); return false;" onmouseover="stopTimeout = true;" onmouseout="removeElement(this); return false;" title="Click to close hint."> "You can open a new window with just this Script content by using this button.";
        }
		<script disable-output-escaping="yes"> {
			<xsl:text disable-output-escaping="yes"> 
				"if ( document.getElementById( 'openInNewWindowButtonHelpPopup' ) ) {
					setTimeout(function(){
						if ( !stopTimeout ) {
							removeElement( document.getElementById( 'openInNewWindowButtonHelpPopup' ) );
						}
					}, 2000);
					setTimeout(function() {
						fadeOut( document.getElementById( 'openInNewWindowButtonHelpPopup' ) );
					}, 1000);
				}"
			;
		}
		<hr style="color: GREY; margin-top: -3px;">;
    }
    <func:result select="$return">;
}

/* bcersows:parseDeviceParameter( $myDevice, $parameterVar );
 *
 * Parses a device specific parameter and returns only the value. For example, turns '{"BNGJMX4":"discard-to-network"}' to 'discard-to-network'.
 *	Test with 'if ( bcersows:parseDeviceParameter( $myDevice, $counterName ) != "" ) {', print or assign to variables with '{ expr bcersows:parseDeviceParameter( $myDevice, $counterName ); }'.
*/
<func:function name="bcersows:parseDeviceParameter"> {
    param $myDevice;
	param $parameterVar;
	
	var $style = {
		expr jcs:regex( ".*\"" _ $myDevice _ "\":\"([^\"]*)\".*}", $parameterVar )[2];
		/*substring-before( substring-after( $parameterVar, $myDevice _ "\":\"" ), "\"" );*/
    }
    <func:result select="$style">;
}

/* bcersows:insertCompletionTest();
 *
 * Inserts a div with an error message that is removed in case the output page loads correctly.
*/
<func:function name="bcersows:insertCompletionTest"> {
	
	var $style = {
		<div id="notCompletedWarning" class="error alignCenter"> {
			uexpr "The script output was not loaded completely. I am truly sorry.<br />Please start it again!!";
		}
		<script> {
			<xsl:text disable-output-escaping="yes">
				"document.body.onload = function() {
					try {
						var element = document.getElementById('notCompletedWarning');
						element.parentNode.removeChild( element );
					} catch (e) {}
				}"
			;
		}
		/*<script> {
			expr "document.body.removeChild( document.getElementById('notCompletedWarning') );";
		}*/
    }
    <func:result select="$style">;
}

/* bcersows:insertDownloadButton( $tableName, $fileName );
 *
 * Inserts a download button.
*/
<func:function name="bcersows:insertDownloadButton"> {
	param $tableName;
	param $fileName;
	
	var $style = {
		<a href="#" onclick="traverse( '" _ $tableName _ "', '" _ $fileName _ "' ); return false;" class="button right buttonDownload" title="Download the output table as CSV."> { expr "Download"; }
    }
    <func:result select="$style">;
}

/* bcersows:disableDownloadButton();
 *
 * Tries to disable the inserted download button.
*/
<func:function name="bcersows:disableDownloadButton"> {
	
	var $style = {
		<script> {
			expr "try { var but = document.scripts[document.scripts.length - 1].parentNode.getElementsByClassName('buttonDownload')[0]; /*but.parentNode.removeChild(but);*/ but.className = but.className + ' disabledButton'; } catch (e) {}";
		}	
	}
    <func:result select="$style">;
}

/* bcersows:insertTLogo();
 *
 * Inserts a right-floating Telekom logo, based on CSS. If different orientation is needed, overwrite class 'tabsLogo'.
*/
<func:function name="bcersows:insertTLogo"> {
	
	var $logo = {
		<span class="tabsLogo unselectable"> {
			<span class="magentaSquare">" ";
			<span> "t";
			<span class="magentaSquare">" ";
			<span class="magentaSquare">" ";
		}
	}
    <func:result select="$logo">;
}

/* bcersows:insertConnectionTestMessage();
 *
 * Inserts the error message used when no connection could be opened.
*/
<func:function name="bcersows:insertConnectionTestMessage"> {
	
	var $msg = {
		<div class="error"> {
			expr "Konnte keine Verbindung aufbauen."; <br>;
			expr "Abbruch folgt..";
			expr os:exit-code(-1);
			expr ".";
			<xsl:message terminate="yes"> "Could not open connection from Script.";
		}
	}
    <func:result select="$msg">;
}

/* bcersows:insertSoftwareInformation( $connection );
 *
 * Inserts the error message used when no connection could be opened.
*/
<func:function name="bcersows:insertSoftwareInformation"> {
	param $connection;
	
	var $si = {
		<div> {
			var $results = jcs:execute( $connection, "get-software-information" );
			if( $results//self::xnm:error ) {
				copy-of bcersows:outputErrorDiv($results, "Fehler.");
			}
		
			<p class="bold">{
				expr "Versionsinformationen";
			}
			<table class="twoColumnTable middle"> {
				<tr> {
					<td> { expr "Ger"; <xsl:text disable-output-escaping="yes"> "&auml;"; expr "tetyp: "; }
					<td> { expr $results/product-name; }
				}
				<tr> {
					<td> { expr "Version:"; }
					<td> { expr $results/package-information[name="junos"]/comment; }
				}
			}
		}
	}
    <func:result select="$si">;
}

/* bcersows:credentials();
 *
 * Function shamelessly stolen from Andy Sharp. Parses the credentials for grouped execution and returns
 * a result tree.
 * Original function: 
 * http://techwiki.juniper.net/Automation_Scripting/010_Getting_Started_and_Reference/Junos_Space_Resources/Local_Scripts/Local_Script_to_Find_Open_Ports_Across_Multiple_Devices
 *
 * Use with:
	var $devices = bcersows:credentials();
	if ( $devices ) {
		for-each( $devices/device) {
			var $local = jcs:open( (target) , (user) , (passwd) );
			var $devicename = (host);
			...
		}
	}
*/
/* this function reads the credentials that are automatically supplied to the script */
/* when the annotation to pass the device credentials is used. this is a requirement */
/* for a locally executed grouped execution script, as the script must handle all    */
/* device connections.                                                               */
<func:function name="bcersows:credentials"> {
	if( $CONTEXT ) {
		var $splitCredentials = str:split( $credentials, "\\;" );
		var $targets := {
			for-each ( $splitCredentials ) {
				var $splitCredential = str:split( ., "\\:" );
				var $user-target = str:split($splitCredential[1], "\@");
				var $host = substring-before( substring-after( $deviceipmap, substring-after( $splitCredential[1], "@" ) _ "\":\"" ), "\"" );
				<device> {
					<target> {
						expr $user-target[2];
					}
					<user> {
						expr $user-target[1];
					}
					<passwd> {
						expr $splitCredential[2];
					}
					<host> {
						expr $host;
					}
				}
			}
		}
		<func:result select="$targets">;
	}
	else {
		<func:result select="false()">;
	}
}

/* bcersows:outputParam( $param );
 *
 * Output bla.
*/
<func:function name="bcersows:outputParam"> {
    param $param;

    var $style = {
    	expr $param;
    }
    
    <func:result select="$style">;
}
